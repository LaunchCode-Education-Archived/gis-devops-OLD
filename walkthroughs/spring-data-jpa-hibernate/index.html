<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>Walkthrough: Cars Demo - Spring Data, JPA, Hibernate :: GIS DevOps</title>

        <link rel="stylesheet" href="https://education.launchcode.org/gis-devops/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://education.launchcode.org/gis-devops/css/highlight.launchcode.css">
        <link rel="stylesheet" href="https://education.launchcode.org/gis-devops/css/main.css">
        <link rel="stylesheet" href="https://djwbyvgln9kts.cloudfront.net/launch_ed_style/custom.css">
    </head>
    <body id='page-walkthrough-cars-demo---spring-data-jpa-hibernate'>

        <header class="navbar navbar-default navbar-fixed-top">

            <ul class="nav navbar-nav">

                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle glyphicon glyphicon-menu-hamburger" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"></a>
                        <ul class="dropdown-menu">
                                                            <li class=" lc-button">
                                    <a href="https://education.launchcode.org/gis-devops/objectives/">
                                        Objectives
                                    </a>
                                </li>
                                                            <li class=" lc-button">
                                    <a href="https://education.launchcode.org/gis-devops/resources/">
                                        Resources
                                    </a>
                                </li>
                                                            <li class=" lc-button">
                                    <a href="https://education.launchcode.org/gis-devops/about/">
                                        About This Course
                                    </a>
                                </li>
                                                        <li role="separator" class="divider"></li>
                            <li>
                                <a href="#modalSearch" data-toggle="modal" data-target="#modalSearch">Search This Site</a>
                            </li>
                        </ul>
                    </li>

                
            </ul>

            <div>
                <a class="navbar-brand site-title navbar-center" href="https://education.launchcode.org/gis-devops/">
                    <h1>GIS DevOps</h1>
                </a>
            </div>

            <div class="nav navbar-nav navbar-right">
                <a class="navbar-brand dabomb" href="https://education.launchcode.org/gis-devops/"></a>
            </div>

        </header>

        <!-- Search Modal -->
        <div id="modalSearch" class="modal fade" role="dialog">
           <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                   <button type="button" class="close" data-dismiss="modal">&times;</button>
                   <h4 class="modal-title">Search GIS DevOps</h4>
                </div>
                <div class="modal-body">
                    <script>
                      (function() {
                        var cx = "014657181352409571810:oq1krtyri4k";
                        var gcse = document.createElement('script');
                        gcse.type = 'text/javascript';
                        gcse.async = true;
                        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
                        var s = document.getElementsByTagName('script')[0];
                        s.parentNode.insertBefore(gcse, s);
                      })();
                    </script>
                    <gcse:search></gcse:search>
                </div>
                <div class="modal-footer">
                   <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>

           </div>
        </div>

        <main class="container-fluid">
            <div class="row">

                <section id="content" class="col-sm-offset-2 col-sm-8">
                                        <h1>Walkthrough: Cars Demo - Spring Data, JPA, Hibernate</h1>
                    <p>In this walkthrough, we revisit the <a href="https://gitlab.com/LaunchCodeTraining/car-integration-test-starter" target="_blank">Car Integration Tests</a> that we worked on in <a href="../walkthroughs/spring-integration-tests/">yesterday's walkthrough</a>. We'll refactor the app to use Postgres and Hiberante.</p>
<h2 id="setup">Setup</h2>
<ol>
<li>In the terminal go to project folder for <em>Car Integration Tests</em></li>
<li>Checkout the branch that contains the solution for the Day 3 walkthrough. Example: <code>$ git checkout master</code> or <code>$git checkout solution</code></li>
<li>Create a new branch for today's work: <code>$ get checkout -b day4-add-hibernate</code></li>
</ol>
<h2 id="our-tasks">Our Tasks</h2>
<p>Each section outlines one task or group of tasks we need to complete.</p>
<h3 id="set-up-a-postgres-db">Set Up A Postgres DB</h3>
<ol>
<li>From <code>psql</code>, create a Postgres user: <code>psql=# create user cart_user with encrypted password 'catdogbluehouse';</code></li>
<li>Create a database: <code>psql=# create database cart;</code></li>
<li>Grant the user access to the database:<code>psql=# grant all privileges on database cart to cart_user</code></li>
</ol>
<h3 id="configure-the-app-to-use-the-database">Configure the App To Use the Database</h3>
<p>In intellij, open <code>/car-integration-tests/src/main/resources/application.properties</code> then set each of these values:</p>
<pre><code class="language-nohighlight">spring.datasource.driver-class-name=
spring.datasource.url=jdbc:postgresql://HOST-HERE:5432/DB-NAME-HERE
spring.datasource.username=USERNAME-HERE
spring.datasource.password=PASSWORD-HERE
spring.jpa.hibernate.ddl-auto=</code></pre>
<aside class="aside-warning">
<p>Committing passwords to source control is a BAD idea, ESPECIALLY a public repo!</p>
</aside>
<p>Then add the associated Postgres dependency to <code>build.gradle</code> as a compile-time dependency.
Set h2 dependency to be a <code>testCompile</code> dependency, since it will only be needed for running tests at this point.</p>
<pre><code class="language-java">dependencies {
    runtime('org.springframework.boot:spring-boot-devtools')
    compile('org.springframework.boot:spring-boot-starter-data-jpa')
    compile('org.springframework.boot:spring-boot-starter-thymeleaf')
    compile('org.springframework.boot:spring-boot-starter-web')
    compile(group: 'org.postgresql', name: 'postgresql', version: '42.1.4')
    testCompile('com.h2database:h2')
    testCompile('org.springframework.boot:spring-boot-starter-test')
}</code></pre>
<h3 id="add-annotations-to-car-model">Add Annotations to Car Model</h3>
<pre><code class="language-java">package org.launchcode.training.models;

import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;

@Entity
public class Car {

    @Id
    @GeneratedValue(strategy= GenerationType.IDENTITY)
    private int id;
    //rest of class is not shown...</code></pre>
<h3 id="add-carrepository">Add CarRepository</h3>
<pre><code class="language-java">package org.launchcode.training.data;

import org.launchcode.training.models.Car;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;

@Repository
public interface CarRepository extends JpaRepository&lt;Cart, Integer&gt; {
}</code></pre>
<h3 id="autowire-repositories-into-controllers">Autowire Repositories into Controllers</h3>
<pre><code class="language-java">@Controller
@RequestMapping("car")
public class CarController {

    @Autowired
    private org.launchcode.training.data.CarRepository carRepository;</code></pre>
<h3 id="autowire-repositories-in-tests">Autowire Repositories in Tests</h3>
<pre><code class="language-java">@RunWith(SpringRunner.class)
@IntegrationTestConfig
public class CarControllerTests {

    @Autowired
    private MockMvc mockMvc;

    @Autowired
    private CarRepository carRepository;</code></pre>
<h3 id="configure-test-db">Configure Test DB</h3>
<p>Add a <code>/car-integration-tests/src/test/resources/application-test.properties</code> file with below contents.</p>
<pre><code class="language-java">spring.datasource.driver-class-name=org.h2.Driver
spring.datasource.url=jdbc:h2:mem:test
spring.jpa.properties.hibernate.dialect = org.hibernate.dialect.H2Dialect
spring.jpa.hibernate.ddl-auto=update</code></pre>
<p>We need to make sure our test properaties are used when running tests. Add the below code to <code>/car-integration-tests/src/test/java/org/launchcode/launchcart/IntegrationTestConfig.java</code></p>
<pre><code class="language-java">@TestPropertySource(locations = "classpath:application-test.properties")</code></pre>
<h3 id="do-the-tests-pass">Do the Tests Pass?</h3>
<p>If not, fix them ;p</p>
                                    </section>

            </div>
        </main>

        <script type="text/javascript" src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
        <script type="text/javascript" src="https://education.launchcode.org/gis-devops/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="https://education.launchcode.org/gis-devops/js/highlight.pack.js"></script>
        <script type="text/javascript" src="https://education.launchcode.org/gis-devops/js/libgif.js"></script>

        <script>
            $(function() {
                $("section>h1").wrap('<div class="page-header" />');

                // Syntax highlighting
                hljs.configure({ displayLabels: true });
                hljs.initHighlightingOnLoad();
            });
        </script>

        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', "UA-78748330-11", 'auto');
            ga('send', 'pageview');

        </script>

    </body>
</html>
