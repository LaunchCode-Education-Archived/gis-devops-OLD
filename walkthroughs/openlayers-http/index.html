<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>Walkthrough: OpenLayers and jQuery :: GIS DevOps</title>

        <link rel="stylesheet" href="https://education.launchcode.org/gis-devops/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://education.launchcode.org/gis-devops/css/highlight.launchcode.css">
        <link rel="stylesheet" href="https://education.launchcode.org/gis-devops/css/main.css">
        <link rel="stylesheet" href="https://djwbyvgln9kts.cloudfront.net/launch_ed_style/custom.css">
    </head>
    <body id='page-walkthrough-openlayers-and-jquery'>

        <header class="navbar navbar-default navbar-fixed-top">

            <ul class="nav navbar-nav">

                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle glyphicon glyphicon-menu-hamburger" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"></a>
                        <ul class="dropdown-menu">
                                                            <li class=" lc-button">
                                    <a href="https://education.launchcode.org/gis-devops/objectives/">
                                        Objectives
                                    </a>
                                </li>
                                                            <li class=" lc-button">
                                    <a href="https://education.launchcode.org/gis-devops/resources/">
                                        Resources
                                    </a>
                                </li>
                                                            <li class=" lc-button">
                                    <a href="https://education.launchcode.org/gis-devops/about/">
                                        About This Course
                                    </a>
                                </li>
                                                        <li role="separator" class="divider"></li>
                            <li>
                                <a href="#modalSearch" data-toggle="modal" data-target="#modalSearch">Search This Site</a>
                            </li>
                        </ul>
                    </li>

                
            </ul>

            <div>
                <a class="navbar-brand site-title navbar-center" href="https://education.launchcode.org/gis-devops/">
                    <h1>GIS DevOps</h1>
                </a>
            </div>

            <div class="nav navbar-nav navbar-right">
                <a class="navbar-brand dabomb" href="https://education.launchcode.org/gis-devops/"></a>
            </div>

        </header>

        <!-- Search Modal -->
        <div id="modalSearch" class="modal fade" role="dialog">
           <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                   <button type="button" class="close" data-dismiss="modal">&times;</button>
                   <h4 class="modal-title">Search GIS DevOps</h4>
                </div>
                <div class="modal-body">
                    <script>
                      (function() {
                        var cx = "014657181352409571810:oq1krtyri4k";
                        var gcse = document.createElement('script');
                        gcse.type = 'text/javascript';
                        gcse.async = true;
                        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
                        var s = document.getElementsByTagName('script')[0];
                        s.parentNode.insertBefore(gcse, s);
                      })();
                    </script>
                    <gcse:search></gcse:search>
                </div>
                <div class="modal-footer">
                   <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>

           </div>
        </div>

        <main class="container-fluid">
            <div class="row">

                <section id="content" class="col-sm-offset-2 col-sm-8">
                                        <h1>Walkthrough: OpenLayers and jQuery</h1>
                    <p>Follow along with the instructor as we get started with jQuery and OpenLayers.</p>
<h2 id="setup">Setup</h2>
<ul>
<li>Fork and clone the <a href="https://gitlab.com/LaunchCodeTraining/jquery-open-layers-starter" target="_blank">JQuery OpenLayers Starter</a> repo.</li>
<li>Create a feature branch named <code>day3-solution</code> or <code>my-solution</code></li>
<li>Open this folder with any editor you choose. We suggest Visual Studio Code since this project is only JavaScript and HTML.</li>
</ul>
<h2 id="review-the-code">Review the code</h2>
<p>Open file  and review its contents</p>
<ul>
<li><code>index.html</code> has a link to a script to <code>js/script.js</code></li>
<li><code>index.html</code> has a <code>&lt;body&gt;</code> and <code>&lt;h2&gt;</code> but not much else</li>
<li><code>js/script.js</code> contains code to instantiate a map</li>
<li><code>js/script.js</code> defines styles</li>
<li><code>js/script.js</code> uses OpenLayers Tile layer <a href="https://openlayers.org/en/v4.6.4/apidoc/ol.source.html" target="_blank">Layer Types</a></li>
<li><code>js/script.js</code> sets the <code>map.view</code> attribute which allows us to position the map at a certain lat long and zoom level using an <code>ol.View</code> object</li>
</ul>
<h2 id="lets-make-a-map-show-up">Let's make a map show up</h2>
<p>Next, add OpenLayers to your project by including the JavaScript source in the head.</p>
<pre><code class="language-html"> &lt;script src="https://openlayers.org/en/v4.6.4/build/ol.js"
         type="text/javascript"&gt;&lt;/script&gt;</code></pre>
<p>Next add a link for JQuery. You can find the current version at <a href="https://code.jquery.com" target="_blank">code.jquery.com</a>. The minified version is fine. We'll use jQuery to make things like AJAX calls and DOM manipulation a bit easier.</p>
<p>Put the placeholder for the map on the page, within the <code>&lt;body&gt;</code>. This <code>div</code> will be replaced with the contents of the rendered map.</p>
<pre><code class="language-html">&lt;div id="mapPlaceholder" class="map"&gt;&lt;/div&gt;</code></pre>
<p>Then set the size for the map, by adding this to the <code>&lt;head&gt;</code></p>
<pre><code class="language-html">&lt;style&gt;
.map {
    height: 400px;
    width: 100%;
}
&lt;/style&gt;</code></pre>
<h2 id="lets-see-it-in-action">Let's see it in action</h2>
<p>Start a web server using <code>python</code> using one of the below commands.</p>
<ol>
<li>Open a terminal in the folder where you cloned the starter repo</li>
<li>Check python version via:
<pre><code class="language-nohighlight">$ python -V</code></pre></li>
<li>If Python version returned above is 3.X:
<pre><code class="language-nohighlight">$ python -m http.server 7070</code></pre>
<p>If Python version returned above is 2.X:</p>
<pre><code class="language-nohighlight">$ python -m SimpleHTTPServer 7070</code></pre></li>
</ol>
<p>In a browser go to <code>http://localhost:7070/index.html</code>. You should see a map that includes Germany.</p>
<h2 id="show-list-of-airports">Show list of airports</h2>
<p>Add the following HTML to <code>index.html</code></p>
<pre><code class="language-html">&lt;button id="list-all-airports"&gt;list airports&lt;/button&gt;
&lt;ul id="all-airports"&gt;&lt;/ul&gt;</code></pre>
<p>Add the following JavaScript to <code>js/script.js</code></p>
<pre><code class="language-js">$('#list-all-airports').on('click', function() {
    console.log('pulling data');
    $('#all-airports').empty();        
    $.getJSON('http://localhost:7070/json/german_airports.geojson', {}).done(function(json) {
        for (var i=0; i&lt;json.features.length; i++) {
            $('#all-airports').append('&lt;li&gt;' + json.features[i].properties.dataField + '&lt;/li&gt;');
        }
    });
});</code></pre>
<h2 id="add-airport-layer-to-the-map">Add Airport layer to the map</h2>
<p>Paste this JS into <code>js/script.js</code>:</p>
<pre><code class="language-js">let vectorSource = new ol.source.Vector({
    format: new ol.format.GeoJSON(),
    url: 'http://localhost:7070/json/german_airports.geojson'
});
vectorLayer = new ol.layer.Vector({
    source: vectorSource,
    style: styleFunction
});
map.addLayer(vectorLayer);</code></pre>
<h2 id="show-airports-when-a-city-is-clicked">Show Airports when a city is clicked</h2>
<p>Let's add a click handler to the map. First, let's try it out in the console. Paste the following code in your browser's dev tools console:</p>
<pre><code class="language-js">map.on('click', function(event) {
    map.forEachFeatureAtPixel(event.pixel, function(feature, layer) {
        console.log(feature);
    });
});</code></pre>
<p>Now when you click on the map, it will print that feature to the console. Inspect the object to make sure it is what you expected. Next take a look at the <a href="https://openlayers.org/en/latest/apidoc/ol.Feature.html" target="_blank">documentation for ol.Feature</a>. How can you access the data on that object?</p>
<p>Try out the <code>get()</code> method on <code>ol.Feature</code> by pasting this into <code>js/script.js</code>. Click on the map and view results in your js console (in your brwoser's dev tools).</p>
<pre><code class="language-js">map.on('click', function(event) {
    map.forEachFeatureAtPixel(event.pixel, function(feature,layer) {
        console.log(feature.get('dataField'));
    });
});</code></pre>
<p>We want to add data about this report to our map dashboard. Here is an example of what we want to show:</p>
<pre><code class="language-html">&lt;ul id="all-airports"&gt;
    &lt;li&gt;
        &lt;h3&gt;Aalen-Heidenheim/Elchingen Airport&lt;/h3&gt;
        &lt;p&gt;ICAO: EPDA&lt;/p&gt;
        &lt;p&gt;Location: Aalen-heidenheim, Germany&lt;/p&gt;
        &lt;p&gt;Altitude: 1916&lt;/p&gt;
        &lt;p&gt;Time Zone: Europe/Berlin&lt;/p&gt;
    &lt;/li&gt;
    &lt;li&gt;
        &lt;h3&gt;A Second Airpot in Clicked City&lt;/h3&gt;
        &lt;p&gt;ICAO2: EPDA2&lt;/p&gt;
        &lt;p&gt;Location: Aalen-heidenheimXYZ, Germany&lt;/p&gt;
        &lt;p&gt;Altitude: 1200&lt;/p&gt;
        &lt;p&gt;Time Zone: Europe/Berlin&lt;/p&gt;
    &lt;/li&gt;
&lt;/ul&gt;</code></pre>
<p>For the next feature we will need to use <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals" target="_blank">Javascript Template Literals</a>. Template literals example below.</p>
<pre><code class="language-javascript">const name = 'Jasmine';
const = `Template literals start and end with ticks and you can includes variables like so. Hello ${name}. 
You can include ' and " inside of the template literals. And you can break into multiple lines.
`;</code></pre>
<p>Update the Map onclick code to display airports. For each feature at a certain pixel, we want to add that feature to the list below the map. OpenLayers will handle some of this work for us via <code>map.forEachFeatureAtPixel()</code>. Remember that the features in this case are airports and we are styling them to be displayed as red circles:</p>
<pre><code class="language-js">map.on('click', function(event) {
    $('#airport-list').empty();    
    map.forEachFeatureAtPixel(event.pixel, function(feature,layer) {
        $('#airport-list').append(`
            &lt;li&gt;
                &lt;h3&gt;${feature.get('locationType')}&lt;/h3&gt;
                &lt;p&gt;ICAO: ${feature.get('icao')}&lt;/p&gt;&lt;p&gt;Location: ${feature.get('dataField')}, ${feature.get('country')}&lt;/p&gt;
                &lt;p&gt;Altitude: ${feature.get('alt')}&lt;/p&gt;
                &lt;p&gt;Time Zone: ${feature.get('tz')}&lt;/p&gt;
            &lt;/li&gt;`
        );
    });
});</code></pre>
<h2 id="click-it">Click it!</h2>
<p>Click on the city and be awed at your development skills.</p>
<h2 id="troubleshooting">Troubleshooting</h2>
<p>Invalid JSON will cause the jQuery callback to not fire. If you are having an issue, validate the JSON that you are sending across the wire. Here is a <a href="https://jsonlint.com/" target="_blank">JSON Validator</a>.</p>
<p>Invalid GeoJSON will not show up on your map. You will see the data pull back, but you will not see any data displayed. Validate your GeoJSON. Here is a <a href="http://geojson.io/o" target="_blank">GeoJSON Validator</a>.</p>
<p>If you get the message <code>The element type "link" must be terminated by the matching end-tag "&lt;/link&gt;".</code>, then add the following tag:<br />
<code>&lt;html lang="en" xmlns:th="http://www.thymeleaf.org/"&gt;</code>;</p>
<p>If you get the message <code>The content of elements must consist of well-formed character data or markup.</code>, then change your inline javascript tags to <code>&lt;script&gt;/*&lt;![CDATA[*/ ..... /*]]&gt;*/&lt;/script&gt;</code>. Here is a <a href="ihttps://stackoverflow.com/questions/4338538/error-parsing-xhtml-the-content-of-elements-must-consist-of-well-formed-charact/4338816">StackOverflow question</a> that discusses this.</p>
<h2 id="references">References</h2>
<ul>
<li><a href="https://openlayers.org/en/latest/apidoc/" target="_blank">Open Layers Docs</a></li>
<li><a href="https://openlayers.org/en/latest/examples/" target="_blank">Open Layers Examples</a></li>
</ul>
                                    </section>

            </div>
        </main>

        <script type="text/javascript" src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
        <script type="text/javascript" src="https://education.launchcode.org/gis-devops/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="https://education.launchcode.org/gis-devops/js/highlight.pack.js"></script>
        <script type="text/javascript" src="https://education.launchcode.org/gis-devops/js/libgif.js"></script>

        <script>
            $(function() {
                $("section>h1").wrap('<div class="page-header" />');

                // Syntax highlighting
                hljs.configure({ displayLabels: true });
                hljs.initHighlightingOnLoad();
            });
        </script>

        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', "UA-78748330-11", 'auto');
            ga('send', 'pageview');

        </script>

    </body>
</html>
