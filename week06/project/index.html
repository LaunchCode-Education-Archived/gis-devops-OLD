<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>Week 6 - Project Week :: GIS DevOps</title>

        <link rel="stylesheet" href="https://education.launchcode.org/gis-devops/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://education.launchcode.org/gis-devops/css/highlight.launchcode.css">
        <link rel="stylesheet" href="https://education.launchcode.org/gis-devops/css/main.css">
        <link rel="stylesheet" href="https://djwbyvgln9kts.cloudfront.net/launch_ed_style/custom.css">
    </head>
    <body id='page-week-6---project-week'>

        <header class="navbar navbar-default navbar-fixed-top">

            <ul class="nav navbar-nav">

                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle glyphicon glyphicon-menu-hamburger" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"></a>
                        <ul class="dropdown-menu">
                                                            <li class=" lc-button">
                                    <a href="https://education.launchcode.org/gis-devops/objectives/">
                                        Objectives
                                    </a>
                                </li>
                                                            <li class=" lc-button">
                                    <a href="https://education.launchcode.org/gis-devops/resources/">
                                        Resources
                                    </a>
                                </li>
                                                            <li class=" lc-button">
                                    <a href="https://education.launchcode.org/gis-devops/about/">
                                        About This Course
                                    </a>
                                </li>
                                                        <li role="separator" class="divider"></li>
                            <li>
                                <a href="#modalSearch" data-toggle="modal" data-target="#modalSearch">Search This Site</a>
                            </li>
                        </ul>
                    </li>

                
            </ul>

            <div>
                <a class="navbar-brand site-title navbar-center" href="https://education.launchcode.org/gis-devops/">
                    <h1>GIS DevOps</h1>
                </a>
            </div>

            <div class="nav navbar-nav navbar-right">
                <a class="navbar-brand dabomb" href="https://education.launchcode.org/gis-devops/"></a>
            </div>

        </header>

        <!-- Search Modal -->
        <div id="modalSearch" class="modal fade" role="dialog">
           <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                   <button type="button" class="close" data-dismiss="modal">&times;</button>
                   <h4 class="modal-title">Search GIS DevOps</h4>
                </div>
                <div class="modal-body">
                    <script>
                      (function() {
                        var cx = "014657181352409571810:oq1krtyri4k";
                        var gcse = document.createElement('script');
                        gcse.type = 'text/javascript';
                        gcse.async = true;
                        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
                        var s = document.getElementsByTagName('script')[0];
                        s.parentNode.insertBefore(gcse, s);
                      })();
                    </script>
                    <gcse:search></gcse:search>
                </div>
                <div class="modal-footer">
                   <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>

           </div>
        </div>

        <main class="container-fluid">
            <div class="row">

                <section id="content" class="col-sm-offset-2 col-sm-8">
                                        <h1>Week 6 - Project Week</h1>
                    <h2 id="project">Project</h2>
<p><a href="../../materials/week06/zika_mission_briefing_3.pdf">Mission Briefing 3</a></p>
<h2 id="overview">Overview</h2>
<p>The Zika Dashboard that your team has built is growing in popularity. In fact, the application is strained under increased load from CDC Scientists. Your team needs to find a way for you app to scale under increased load. The goals of this mission are as follows:</p>
<ol>
<li>Deploy your application remotely using Amazon Web Services.</li>
<li>Configure a Jenkins job to automatically build and test your code. Jenkins should save an executable JAR file to S3 if all of the relevant checkes pass.</li>
</ol>
<h2 id="requirements">Requirements</h2>
<p>To complete this project, your app should meet the following requirements:</p>
<ul>
<li>Your application is deployed via AWS at a live URL.</li>
<li>Your application can consistently handle 300 requests per second.</li>
<li><strong>Bonus:</strong>  Jenkins watches your repo pushes a release to S3 if all of the following pass:
<ul>
<li>All JUnit tests pass.</li>
<li>ESLint has no warnings.</li>
</ul></li>
</ul>
<h3 id="a-couple-of-notes">A Couple of Notes</h3>
<p>There will be a few differences in this project compared to previous week's studios:</p>
<ol>
<li>You will be using the <code>CentOS</code> operating system. <code>CentOS</code> is a free, enterprise class, Linux distribution based on Red Hat Enterprise Linux. Most of the commands will be the same as Ubuntu, except the package manager will use <code>yum install</code> instead of <code>apt-get install</code>. Here is the <a href="https://wiki.centos.org/Cloud/AWS" target="_blank">URL to the AWS Image of CentOS</a></li>
<li>You will be working in <code>us-west-2</code> region (also known as <code>Oregon</code>).</li>
<li>The project has been upgraded to Gradle 4.4. You'll want to use your existing project, but Feel free to merge in changes from the <a href="https://gitlab.com/LaunchCodeTraining/zika-cdc-dashboard/tree/week6-starter" target="_blank">week6-starter branch</a>. Use the command <code>gradle clean bootJar</code> to build your project.</li>
<li>You will be running ElasticSearch remotely in this project. You'll need to spin up a <code>t2.small</code> EC2 instance to serve ElasticSearch. Use the <a href="https://gitlab.com/LaunchCodeTraining/zika-cdc-dashboard/blob/week6-starter/cloud/elastic_userdata.sh" target="_blank"><code>startup_elasticsearch.sh</code> script</a> in the week6-starter project to configure a <code>t2.medium</code> machine. If you get an &quot;Out of Memory Exception&quot;, be sure to increase the heap size by setting <code>Xms3g</code> and <code>Xmx4g</code> in the <code>/etc/elasticsearch/jvm.options</code> file.</li>
<li>You will need to setup a temporary <code>t2.medium</code> that also has your java web app on it. You will only use this instance to run the <code>\reindex</code> endpoint. That endpoint requires a lot of memory, if you try to have your web app handle that on a <code>t2.micro</code> or <code>t2.small</code> they will return java heap errors. After you have ran the endopint and populated your Elasticsearch you can delete the <code>t2.medium</code></li>
</ol>
<p>To run Elasticsearch locally, we are going to be using Docker, here is the command:</p>
<ul>
<li>Download docker installer from <a href="https://store.docker.com/editions/community/docker-ce-desktop-mac" target="_blank">here</a></li>
<li>That will isntall docker as a service and an application that will run everytime your computer starts. (look for the whale icon in your menu bar at the top of your mac)</li>
<li>Now you can run <code>$ docker</code> commands in your terminal. Like the one below.</li>
</ul>
<pre><code class="language-nohighlight">$ docker run -p 9200:9200 -p 9300:9300 -e "discovery.type=single-node"  -e "xpack.security.enabled=false" docker.elastic.co/elasticsearch/elasticsearch:5.6.0</code></pre>
<aside class="aside-note">
<p>Be sure to stop your home brew Elasticsearch by running <code>brew services stop elasticsearch</code></p>
</aside>
<p>Deploy whatever app you currently have working. For example, if you have ElasticSearch working be sure to spin up an ElasticSearch instance on AWS.</p>
<aside class="aside-note">
<p>To log into a CentOS instance, you will need to use the username <code>centos</code>.</p>
</aside>
<h2 id="setup">Setup</h2>
<p>To get started, you are provided with a CloudFormation template in an S3 bucket. This CloudFormation template provisions a VPC with the following:</p>
<ol>
<li>Two public subnets with an internet gateway (each in their own availability zone).</li>
<li>Two private subnets (each in their own availability zone).</li>
<li>One security group for web servers (ports 80 and 22 open). <code>WebAppSecurityGroup</code></li>
<li>One security group for databases (port 5432 open). <code>DatabaseSecurityGroup</code></li>
<li>One security group for load balancers (port 80 open). <code>ELBSecurityGroup</code></li>
</ol>
<p>The setup CloudFormation script can be found at:</p>
<p><a href="https://s3.amazonaws.com/launchcode-gisdevops-cloudformation/zika_cloudformation.json" target="_blank">https://s3.amazonaws.com/launchcode-gisdevops-cloudformation/zika_cloudformation.json</a></p>
<p>Follow the instruction from the <a href="https://education.launchcode.org/gis-devops/studios/AWS3#configure-your-vpc" target="_blank">Scaling AWS Studio</a> to setup your VPC from a CloudFormation script.</p>
<p>Also, since we're working in <code>us-west-2</code>, remember we need to reconfigure your <code>aws-cli</code> so that you're working in a the <code>us-west-2</code> region.</p>
<pre><code class="language-nohighlight">$ aws configure
AWS Access Key ID [****************7S3A]:
AWS Secret Access Key [****************hdWj]:
Default region name [us-east-1]: us-west-2
Default output format [None]:</code></pre>
<h2 id="getting-things-working">Getting things Working</h2>
<p>It will probably be helpful to spin up a machine to configure your database and check that everything works. After you set up the database and check your configuration with your <code>t2.medium</code> machine, it would be good to keep the machine around to perform long running tasks like reindexing Elasticsearch (Reindexing Elasticsearch requires a machine with 4GB of memory). Be sure to run the reindex command directly on the machine's IP address; the command will time out if sent through the load balancer.</p>
<p>Here are a few steps:</p>
<ol>
<li>Spin up a <code>t2.medium</code> CentOS instance in your VPC and name it something like <code>AdminMachine-YourName</code>.</li>
<li>Install <code>telnet</code> using Yum. Make sure that you can telnet to your database <code>telnet endpoint-of-your-db 5432</code>.</li>
<li>Jump into the postgres console using <code>psql -h endpoint-of-your-db -U masterUsername zika</code> (hint you may need to install the <code>postgresql</code> library via <code>yum</code>).</li>
<li>Once in the database, create a database user for the app <code>CREATE USER zika WITH PASSWORD 'verysecurepassword</code>. </li>
<li>Also, once in the database install all of the PostGIS extensions (see previous studios) as well as the <a href="https://www.postgresql.org/docs/10/static/unaccent.html" target="_blank">unaccent Postgres extension</a></li>
<li>Upload your <code>location.csv</code> and your <code>all_reports.csv</code> and install them in the database using a command like:</li>
</ol>
<pre><code class="language-nohighlight">$ psql -h gary-zika-db.cq2s2klvmrfq.us-west-2.rds.amazonaws.com -d zika -U zika_app_user -c "\copy location(ID_0,ISO,NAME_0,ID_1,NAME_1,HASC_1,CCN_1,CCA_1,TYPE_1,ENGTYPE_1,NL_NAME_1,VARNAME_1,geom) from STDIN WITH DELIMITER E'\t' CSV" &lt; locations.csv</code></pre>
<ol start="7">
<li>Use the <a href="https://gitlab.com/LaunchCodeTraining/zika-cdc-dashboard/blob/week6-starter/cloud/elastic_userdata.sh" target="_blank">Elasticsearch UserData script</a> to spin up an Elasticsearch.</li>
<li>Upload a copy of your executable jar to the home directory of the machine. Set all of the environment variables on the command line (i.e. <code>export APP_DB_NAME=zika</code>)</li>
<li>If your app runs, you know that everything is setup for your to start configuring your AutoScaling groups!</li>
</ol>
                                    </section>

            </div>
        </main>

        <script type="text/javascript" src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
        <script type="text/javascript" src="https://education.launchcode.org/gis-devops/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="https://education.launchcode.org/gis-devops/js/highlight.pack.js"></script>
        <script type="text/javascript" src="https://education.launchcode.org/gis-devops/js/libgif.js"></script>

        <script>
            $(function() {
                $("section>h1").wrap('<div class="page-header" />');

                // Syntax highlighting
                hljs.configure({ displayLabels: true });
                hljs.initHighlightingOnLoad();
            });
        </script>

        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', "UA-78748330-11", 'auto');
            ga('send', 'pageview');

        </script>

    </body>
</html>
