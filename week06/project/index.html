<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>Week 6 - Project Week :: GIS DevOps</title>

        <link rel="stylesheet" href="https://education.launchcode.org/gis-devops/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://education.launchcode.org/gis-devops/css/highlight.launchcode.css">
        <link rel="stylesheet" href="https://education.launchcode.org/gis-devops/css/main.css">
        <link rel="stylesheet" href="https://djwbyvgln9kts.cloudfront.net/launch_ed_style/custom.css">
    </head>
    <body id='page-week-6---project-week'>

        <header class="navbar navbar-default navbar-fixed-top">

            <ul class="nav navbar-nav">

                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle glyphicon glyphicon-menu-hamburger" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"></a>
                        <ul class="dropdown-menu">
                                                            <li class=" lc-button">
                                    <a href="https://education.launchcode.org/gis-devops/objectives/">
                                        Objectives
                                    </a>
                                </li>
                                                            <li class=" lc-button">
                                    <a href="https://education.launchcode.org/gis-devops/resources/">
                                        Resources
                                    </a>
                                </li>
                                                            <li class=" lc-button">
                                    <a href="https://education.launchcode.org/gis-devops/about/">
                                        About This Course
                                    </a>
                                </li>
                                                        <li role="separator" class="divider"></li>
                            <li>
                                <a href="#modalSearch" data-toggle="modal" data-target="#modalSearch">Search This Site</a>
                            </li>
                        </ul>
                    </li>

                
            </ul>

            <div>
                <a class="navbar-brand site-title navbar-center" href="https://education.launchcode.org/gis-devops/">
                    <h1>GIS DevOps</h1>
                </a>
            </div>

            <div class="nav navbar-nav navbar-right">
                <a class="navbar-brand dabomb" href="https://education.launchcode.org/gis-devops/"></a>
            </div>

        </header>

        <!-- Search Modal -->
        <div id="modalSearch" class="modal fade" role="dialog">
           <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                   <button type="button" class="close" data-dismiss="modal">&times;</button>
                   <h4 class="modal-title">Search GIS DevOps</h4>
                </div>
                <div class="modal-body">
                    <script>
                      (function() {
                        var cx = "014657181352409571810:oq1krtyri4k";
                        var gcse = document.createElement('script');
                        gcse.type = 'text/javascript';
                        gcse.async = true;
                        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
                        var s = document.getElementsByTagName('script')[0];
                        s.parentNode.insertBefore(gcse, s);
                      })();
                    </script>
                    <gcse:search></gcse:search>
                </div>
                <div class="modal-footer">
                   <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>

           </div>
        </div>

        <main class="container-fluid">
            <div class="row">

                <section id="content" class="col-sm-offset-2 col-sm-8">
                                        <h1>Week 6 - Project Week</h1>
                    <h2 id="project">Project</h2>
<p><a href="../../materials/week06/zika_mission_briefing_3.pdf">Mission Briefing 3</a></p>
<h2 id="overview">Overview</h2>
<p>The Zika Dashboard that your team has built is growing in popularity. In fact, the application is strained under increased load from CDC Scientists. Your team needs to find a way for you app to scale under increased load. The goals of this mission are as follows:</p>
<ol>
<li>Deploy your application remotely using Amazon Web Services.</li>
<li>Configure a Jenkins job to automatically build and test your code. Jenkins should save an executable JAR file to S3 if all of the relevant checkes pass.</li>
</ol>
<h2 id="requirements">Requirements</h2>
<p>To complete this project, your app should meet the following requirements:</p>
<ul>
<li>Your application is deployed via AWS at a live URL</li>
<li>You use CentOS for your EC2 instances (details below)</li>
<li>Setup a LaunchConfiguration to spin up new Web App EC2 instances</li>
<li>You setup a VPC for your Web app, RDS, and ElasticSearch</li>
<li>ElasticSearch is hosted on an EC2 inside your VPC</li>
<li>Your application can consistently handle 300 requests per second</li>
<li>Jenkins watches your repo pushes a release to S3 if all of the following pass:
<ul>
<li>All tests pass</li>
</ul></li>
<li>ESLint has no warnings</li>
</ul>
<h2 id="new-stuff">New Stuff</h2>
<p>There will be a few differences in this project compared to previous week's studios/project.  You may want to copy over certain changes instead of merging <a href="https://gitlab.com/LaunchCodeTraining/zika-cdc-dashboard/tree/week6-starter" target="_blank">Week 6 Starter</a>. NOTE that the starter branch only contains config, property, and aws scripts. The starter branch does not contain a solution for week 4.</p>
<p>Review the changes by looking at this branch comparison: <a href="https://gitlab.com/LaunchCodeTraining/zika-cdc-dashboard/compare/week4-starter...week6-starter" target="_blank">week4 compared to week6</a></p>
<h3 id="specific-changes">Specific Changes</h3>
<ol>
<li>You will be using the <code>CentOS</code> operating system instead of <code>Ubuntu</code></li>
<li>Using Spring Data 2.0.2 (dependencies have been updated in build.gradle)</li>
<li>When running locally you will be running ElasticSearch inside a docker instance (details below)</li>
<li>When running in the cloud you will be running ElasticSearch on an EC2 instance</li>
</ol>
<h2 id="setup-locally">Setup Locally</h2>
<p>To run Elasticsearch locally, we are going to be using Docker:</p>
<ul>
<li>Download docker installer from <a href="https://store.docker.com/editions/community/docker-ce-desktop-mac" target="_blank">here</a></li>
<li>That will install docker as a service and an application that will run everytime your computer starts. (look for the whale icon in your menu bar at the top of your mac)</li>
<li>Now you can run <code>$ docker</code> commands in your terminal. Like the one below. (this runs a docker instance that contains ElasticSearch)</li>
<li>The connection information for the docker version of ElasticSearch is contained in the comments of <a href="https://gitlab.com/LaunchCodeTraining/zika-cdc-dashboard/blob/week6-starter/src/main/resources/application.properties" target="_blank">this file</a> </li>
<li>MAKE SURE YOUR TESTS ARE PASSING LOCALLY BEFORE MOVING TO THE CLOUD
<aside class="aside-note">
<p>Be sure to stop your home brew Elasticsearch by running <code>brew services stop elasticsearch</code></p>
</aside>
<p>Create the container (NOTE: An id will be returned)</p>
<pre><code class="language-nohighlight">$ docker create -p 9200:9200 -p 9300:9300 -e "discovery.type=single-node"  -e "xpack.security.enabled=false" docker.elastic.co/elasticsearch/elasticsearch:5.6.0
63918ba7994482d94bdaf7bbc2005d91e0ac2f02a88039ebe2521ed9d9e8e8b8 &lt;----- this is returned after the above command, it's id of the container that is created COPY THIS SOMEHWERE</code></pre>
<p>Start the container</p>
<pre><code class="language-nohighlight">$ docker start 63918ba7994482d94bdaf7bbc2005d91e0ac2f02a88039ebe2521ed9d9e8e8b8</code></pre></li>
</ul>
<p>You can restart or stop the container as well</p>
<ul>
<li><code>$ docker restart 63918ba7994482d94bdaf7bbc2005d91e0ac2f02a88039ebe2521ed9d9e8e8b8</code> </li>
<li><code>$ docker stop 63918ba7994482d94bdaf7bbc2005d91e0ac2f02a88039ebe2521ed9d9e8e8b8</code></li>
</ul>
<aside class="aside-warning">
<p>The error <code>None of the configured nodes are available</code> can be caused by starting up your Web App before ElasticSearch is running. This can also happen if you restart your ElasticSearch while your Web App is running.</p>
</aside>
<h2 id="setup-in-the-cloud">Setup in the Cloud</h2>
<h3 id="centos">CentOS</h3>
<p><code>CentOS</code> is a free, enterprise class, Linux distribution based on Red Hat Enterprise Linux. Most of the commands will be the same as Ubuntu, except the package manager will use <code>yum install</code> instead of <code>apt-get install</code>. CentOS comes with less software installed than Ubuntu. For example <code>telnet</code> has to be installed via <code>sudo yum install telnet</code>. <a href="https://wiki.centos.org/Cloud/AWS" target="_blank">Info on Image of CentOS we will use</a></p>
<aside class="aside-note">
<p>To <code>ssh</code> into a CentOS instance, you will need to use the username <code>centos</code>.</p>
</aside>
<p>How to manually create an AWS EC2 instance using CentOS</p>
<ul>
<li>Go to Oregon Region</li>
<li>Click <strong>Launch Instance</strong> in the EC2 Dashboard</li>
<li>Click <strong>My AMIs</strong></li>
<li>Search for <strong>centos</strong></li>
<li>Click <strong>CentOS Image</strong> </li>
</ul>
<p><img src="../../materials/week06/centos-image.png" alt="CentOS Image" /></p>
<h3 id="cloud-elasticsearch">Cloud ElasticSearch</h3>
<p>In the clouid you will be running ElasticSearch on it's own EC2 instance.</p>
<ul>
<li>
<p>You will need to spin up a <code>t2.small</code> EC2 instance to serve ElasticSearch.</p>
</li>
<li>Use the <a href="https://gitlab.com/LaunchCodeTraining/zika-cdc-dashboard/blob/week6-starter/cloud/elastic_userdata.sh" target="_blank"><code>startup_elasticsearch.sh</code> script</a> in the week6-starter project to configure a <code>t2.small</code> machine.</li>
<li>If you get an &quot;Out of Memory Exception&quot;, be sure to increase the heap size by setting <code>Xms3g</code> and <code>Xmx4g</code> in the <code>/etc/elasticsearch/jvm.options</code> file.</li>
</ul>
<h3 id="create-and-populate-the-rds">Create and Populate the RDS</h3>
<p>You will need to spin up an &quot;YourName-AdminMachine&quot; to configure your RDS. You will likely use this same machine to populate your ElasticSearch instance.</p>
<ol>
<li>Create CentOS EC2 named &quot;YourName-ZikaAdminMachine&quot;</li>
<li>Install Postgresql</li>
<li>Copy over .csv files to the server</li>
<li>Create the db tables
<ul>
<li>By starting the web app</li>
<li>Or running an sql script with create table statements</li>
</ul></li>
<li>Run psql COPY commands to populate the tables</li>
</ol>
<h3 id="seed-the-elasticsearch-data-store">Seed the ElasticSearch Data Store</h3>
<p>When you ElasticSearch instance starts it has not data. We need to insert all reports in Postgresl into ElasticSearch.</p>
<ol>
<li>Make a <code>POST</code> reuqest to <code>/api/_cluster/reindex</code> on &quot;YourName-AdminMachine&quot; EC2</li>
<li>This instance can be spun down after your RDS and ElasticSearch is working
<aside class="aside-note">
<p>The &quot;YourName-AdminMachine&quot; instance may need to be a <code>t2.small</code> or <code>t2.medium</code> in order to handle the POST request that transfers all the reports to ElasticSearch. You will know this is the case if you see &quot;out of memory&quot; exceptions.</p>
</aside></li>
</ol>
<h3 id="vpc-setup">VPC Setup</h3>
<p>To get started, you are provided with a CloudFormation template in an S3 bucket. This CloudFormation template provisions a VPC with the following:</p>
<ol>
<li>Two public subnets with an internet gateway (each in their own availability zone).</li>
<li>Two private subnets (each in their own availability zone).</li>
<li>One security group for web servers (ports 80 and 22 open). <code>WebAppSecurityGroup</code></li>
<li>One security group for databases (port 5432 open). <code>DatabaseSecurityGroup</code></li>
<li>One security group for load balancers (port 80 open). <code>ELBSecurityGroup</code></li>
</ol>
<p>The setup CloudFormation script can be found at:</p>
<p><a href="https://s3.amazonaws.com/launchcode-gisdevops-cloudformation/zika_cloudformation.json" target="_blank">https://s3.amazonaws.com/launchcode-gisdevops-cloudformation/zika_cloudformation.json</a></p>
<p>Follow the instruction from the <a href="https://education.launchcode.org/gis-devops/studios/AWS3#configure-your-vpc" target="_blank">Scaling AWS Studio</a> to setup your VPC from a CloudFormation script.</p>
                                    </section>

            </div>
        </main>

        <script type="text/javascript" src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
        <script type="text/javascript" src="https://education.launchcode.org/gis-devops/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="https://education.launchcode.org/gis-devops/js/highlight.pack.js"></script>
        <script type="text/javascript" src="https://education.launchcode.org/gis-devops/js/libgif.js"></script>

        <script>
            $(function() {
                $("section>h1").wrap('<div class="page-header" />');

                // Syntax highlighting
                hljs.configure({ displayLabels: true });
                hljs.initHighlightingOnLoad();
            });
        </script>

        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', "UA-78748330-11", 'auto');
            ga('send', 'pageview');

        </script>

    </body>
</html>
