<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>Studio: AWS Devops Basics :: GIS DevOps</title>

        <link rel="stylesheet" href="https://education.launchcode.org/gis-devops/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://education.launchcode.org/gis-devops/css/highlight.launchcode.css">
        <link rel="stylesheet" href="https://education.launchcode.org/gis-devops/css/main.css">
        <link rel="stylesheet" href="https://djwbyvgln9kts.cloudfront.net/launch_ed_style/custom.css">
    </head>
    <body id='page-studio-aws-devops-basics'>

        <header class="navbar navbar-default navbar-fixed-top">

            <ul class="nav navbar-nav">

                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle glyphicon glyphicon-menu-hamburger" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"></a>
                        <ul class="dropdown-menu">
                                                            <li class=" lc-button">
                                    <a href="https://education.launchcode.org/gis-devops/objectives/">
                                        Objectives
                                    </a>
                                </li>
                                                            <li class=" lc-button">
                                    <a href="https://education.launchcode.org/gis-devops/resources/">
                                        Resources
                                    </a>
                                </li>
                                                            <li class=" lc-button">
                                    <a href="https://education.launchcode.org/gis-devops/about/">
                                        About This Course
                                    </a>
                                </li>
                                                        <li role="separator" class="divider"></li>
                            <li>
                                <a href="#modalSearch" data-toggle="modal" data-target="#modalSearch">Search This Site</a>
                            </li>
                        </ul>
                    </li>

                
            </ul>

            <div>
                <a class="navbar-brand site-title navbar-center" href="https://education.launchcode.org/gis-devops/">
                    <h1>GIS DevOps</h1>
                </a>
            </div>

            <div class="nav navbar-nav navbar-right">
                <a class="navbar-brand dabomb" href="https://education.launchcode.org/gis-devops/"></a>
            </div>

        </header>

        <!-- Search Modal -->
        <div id="modalSearch" class="modal fade" role="dialog">
           <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                   <button type="button" class="close" data-dismiss="modal">&times;</button>
                   <h4 class="modal-title">Search GIS DevOps</h4>
                </div>
                <div class="modal-body">
                    <script>
                      (function() {
                        var cx = "014657181352409571810:oq1krtyri4k";
                        var gcse = document.createElement('script');
                        gcse.type = 'text/javascript';
                        gcse.async = true;
                        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
                        var s = document.getElementsByTagName('script')[0];
                        s.parentNode.insertBefore(gcse, s);
                      })();
                    </script>
                    <gcse:search></gcse:search>
                </div>
                <div class="modal-footer">
                   <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>

           </div>
        </div>

        <main class="container-fluid">
            <div class="row">

                <section id="content" class="col-sm-offset-2 col-sm-8">
                                        <h1>Studio: AWS Devops Basics</h1>
                    <h2 id="overview">Overview</h2>
<p>Your goal is to deploy a Spring Boot project to a remote server and verify its execution. This will establish the basics for working in a cloud environment.</p>
<h2 id="set-up-project">Set Up Project</h2>
<ul>
<li>Build the Airwaze Studio project, or check out the <code>elasticsearch-starter</code> branch.</li>
<li>
<p>Change <code>src/main/resources/import.sql</code> to:</p>
<pre><code class="language-nohighlight">COPY route(src, src_id, dst, dst_id, airline, route_geom) from '/home/airwaze/routes.csv' DELIMITER ',' CSV HEADER;
COPY airport(airport_id, name, city, country, faa_code, icao, altitude, time_zone, airport_lat_long) from '/home/airwaze/Airports.csv' DELIMITER ',' CSV HEADER;</code></pre>
</li>
<li>Go into IntelliJ's Gradle tool window, and click on <code>Tasks &gt; build &gt; bootRepackage</code>.</li>
<li>Verify the jar appears in <code>build/libs</code></li>
</ul>
<h2 id="start-an-instance-on-aws">Start an Instance on AWS</h2>
<ol>
<li>Go to the EC2 Dashboard:
<ul>
<li>Click on <code>Services</code> in the page header.</li>
<li>Locate and click on <code>EC2</code> under <strong>Compute</strong>.</li>
</ul></li>
</ol>
<p><img src="../../materials/week05/ec2-in-services.png" alt="Screen shot of AWS console with a red arrow pointing to the EC2 link in the Services dropdown" /></p>
<ol start="2">
<li>On the EC2 Dashboard
<ul>
<li>Locate and click the <code>Instances</code> link in the sidebar</li>
</ul></li>
</ol>
<p><img src="../../materials/week05/instances-in-sidebar.png" alt="Screen shot of AWS console with a red arrow pointing to the Instances link in the sidebar" /></p>
<ol start="3">
<li>On the Instances screen
<ul>
<li>Locate and click the <code>Launch Instance</code> button at the top of the page</li>
</ul></li>
</ol>
<p><img src="../../materials/week05/launch-instance-button.png" alt="Screen shot of AWS console with a red circle around the Launch Instance button" /></p>
<h2 id="starting-an-aws-instance">Starting an AWS Instance</h2>
<p>When creating a new instance, Amazon provides multiple free <strong>Amazon Machine Images</strong> (AMIs) to choose from. This is a pre-configured operating system installation with multiple tools ready for use. For this exercise, we want to use the <strong>Ubuntu Server 16.04 LTS</strong> AMI. Locate it in the list of &quot;Quick Start&quot; images and click its <code>Select</code> button.</p>
<p><img src="../../materials/week05/ubuntu-server-ami.png" alt="Screen shot showing Ubuntu Server selection in AMI screen" /></p>
<p>Next, the console will ask which type of instance to set up. Your choice here defines the amount of virtual CPU cores, RAM, and network perforance you want. This also directly affects the cost of the running instance. Select the <code>t2.micro</code> service, then click &quot;Configure Instance Details&quot;.</p>
<p><img src="../../materials/week05/t2-micro-instance.png" alt="Screen show with t2.micro selected and red circle highlighting the selection" /></p>
<p>The following screen allows for configuration of instance. We do not need to customize this image beyond the defaults, so you can continue to &quot;Add Storage&quot;.</p>
<p>On this screen, you can choose what storage is available to your instance. AWS will provision a virtual volume in Elastic Block Store to serve as the volume(s) mounted in your instance. By default, it will create an 8 GiB volume to serve as the instance's root volume. The default 8 GiB volume is sufficient for this application. Click on &quot;Add Tags&quot; to progress to the next step.</p>
<p><img src="../../materials/week05/storage-options.png" alt="Screen shot showing pre-filled 8 GiB storage selection" /></p>
<p>The &quot;Add Tags&quot; screen is useful for larger enterprise environments, for instance, where ownership and internal billing of instances can be broken down by tags. For this exercise, we do not need any tags, so progress to &quot;Configure Security Group&quot;.</p>
<p><img src="../../materials/week05/add-tags-screen.png" alt="Screen shot demonstrating an empty Add Tags screen and the Add Tag button" /></p>
<p>Configuring the security groups for your server is critical for protecting your instance from unauthorized remote access. You are liable for the work and costs generated by your instance. An openly-accessible instance can risk your infrastructure security and total costs if it were to be compromised.</p>
<ul>
<li>Create a new security group for your instance with a unique name</li>
<li>Add a useful description for the security group so you know its purpose in the future</li>
<li>Change the existing rule's source to &quot;My IP&quot;
<ul>
<li>This allows remote SSH access to your instance, but only from the IP you're currently using to access AWS</li>
</ul></li>
<li>Continue to &quot;Review and Launch&quot;</li>
</ul>
<p><img src="../../materials/week05/security-group-setup.png" alt="Screen shot showing Create Security Group page with My IP circled in red to highlight the selection" /></p>
<p>This screen gives you a final chance to review and change the settings you chose for this instance. Open the dropdowns on the screen and when you're ready, click &quot;Launch&quot;.</p>
<p>This will open a popup on the screen that allows you to configure a key pair for the instance. This will generate the key necessary to SSH into the instance and without this you will not be able to access your instance. In an enterprise environment, there will likely already be multiple key pairs set up that you would use here. For the purpose of this project, create a new key pair:</p>
<ul>
<li>Select &quot;Create a new key pair&quot; in the first select box</li>
<li>Give your key pair a good name, possibly the same name you gave your security group</li>
<li>Click &quot;Download Key Pair&quot;</li>
<li>Store this <code>*.pem</code> file in a good location and do not lose it</li>
<li>Click &quot;Launch Instances&quot;</li>
</ul>
<p>AWS will now begin launching your instance. You can click the identifier for your instance to monitor it as it starts up. This will take you back to the Instances dashboard. Take note of your instance's public DNS and IP; you will need this in order to SSH into your instance later.</p>
<p><img src="../../materials/week05/instances-dashboard-launching.png" alt="Screen shot showing Instances dashboard and a running instance. A red circle is around the Public DNS entry." /></p>
<h2 id="set-up-ssh">Set up SSH</h2>
<ul>
<li>Open the terminal.</li>
<li>Navigate to your user's ssh configuration folder:
<pre><code class="language-nohighlight">$ cd ~/.ssh</code></pre></li>
<li>Copy your instance's *.pem file to your .ssh folder:
<pre><code class="language-nohighlight">$ cp /path/to/*.pem .</code></pre></li>
<li>Change the permissions for this file to read-only by your user:
<pre><code class="language-nohighlight">$ chmod 400 name-of-pem.pem</code></pre></li>
<li>Using the Public DNS you noted before and your *.pem file, access your AWS instance:
<pre><code class="language-nohighlight">$ ssh -i ~/.ssh/name-of-pem.pem ubuntu@insert-public-DNS-here</code></pre></li>
<li>The ssh program will likely warn that the authenticity of your host can't be established since it's not seen it before. Respond &quot;yes&quot; to continue connecting. It will add it to the list of known hosts and continue the connection process.</li>
<li>The remote terminal will appear</li>
</ul>
<p><img src="../../materials/week05/ssh-to-instance.png" alt="Screen shot of terminal showing successful SSH connection to AWS instance" /></p>
<p>Congratulations! You have successfully created and connected to an instance running in the cloud.</p>
<h2 id="running-your-application-in-the-cloud">Running Your Application In the Cloud</h2>
<p>Now that you have a server running in the cloud, you need to use it to do some work. Let's prepare the server to run our application.</p>
<p>First, you don't want the application running under your system account, so we need to create a new user with a password:</p>
<pre><code class="language-nohighlight">$ sudo adduser airwaze</code></pre>
<p>Next, from your local machine, upload the Airwaze Studio jar to the server. We'll use scp to securely transmit the file to our server.</p>
<pre><code class="language-nohighlight">$ scp -i ~/.ssh/name-of-pem.pem /path/to/local/app.jar ubuntu@ec2-public-dns.us-east-2.compute.amazonaws.com:/home/ubuntu/app.jar
$ scp -i ~/.ssh/name-of-pem.pem /path/to/local/routes.csv ubuntu@ec2-public-dns.us-east-2.compute.amazonaws.com:/home/ubuntu/routes.csv
$ scp -i ~/.ssh/name-of-pem.pem /path/to/local/Airports.csv ubuntu@ec2-public-dns.us-east-2.compute.amazonaws.com:/home/ubuntu/Airports.csv</code></pre>
<p>Now log in to the server:</p>
<pre><code class="language-nohighlight">$ ssh -i ~/.ssh/name-of-pem.pem ubuntu@ec2-public-dns.us-east-2.compute.amazonaws.com</code></pre>
<p>Now, on the server, move the file to the airwaze home directory, and make it owned and executable by that user.</p>
<pre><code class="language-nohighlight">$ sudo apt-get install openjdk-8-jdk
$ sudo mv ~/app.jar /home/airwaze/app.jar
$ sudo mv ~/*.csv /home/airwaze
$ sudo chown -R airwaze:airwaze /home/airwaze
$ sudo chmod 500 /home/airwaze/app.jar</code></pre>
<p>Before trying to start the application, we'll install <code>postgres</code> locally so we can start Airwaze Studio. <strong>This is something you would <em>never</em> do in a real cloud instance</strong>, but we'll do it just for this demonstration so our app will start.</p>
<pre><code class="language-nohighlight">$ sudo apt-get update
$ sudo apt-get install postgresql postgresql-contrib postgis
$ sudo -u postgres createuser --pwprompt airwaze_app_user # give password `somethingsensible`
$ sudo -u postgres createdb -O airwaze_app_user airwaze
$ sudo vim /etc/postgresql/9.5/main/pg_hba.conf</code></pre>
<p>When the configuration file comes up, you'll see that almost all of the lines are commented out.  Towards the bottom you find lines that are not commented out.  Press <code>i</code> to get into Insert mode, and change the line with <code>local all all peer</code> to <code>local all all md5</code>.  When you're done, press <code>escape</code> to get out of insert mode.  Press <code>:</code> to bring up a prompt, then press <code>w</code> (for 'write') and <code>q</code> (for 'quit'), followed by <code>return</code>.</p>
<pre><code class="language-nohighlight">$ sudo /etc/init.d/postgresql restart
$ sudo -u postgres psql airwaze
CREATE EXTENSION postgis;
CREATE EXTENSION postgis_topology;
CREATE EXTENSION fuzzystrmatch;
CREATE EXTENSION postgis_tiger_geocoder;
ALTER USER airwaze_app_user SUPERUSER;</code></pre>
<p>Now that the app is on the cloud server and the database is ready, we can set up <code>systemd</code> to run this app as a service.</p>
<p>In order to use <code>systemd</code>, we have to make a script in <code>/etc/systemd/system</code> to tell the service how to run our app.</p>
<pre><code class="language-nohighlight">$ sudo vim /etc/systemd/system/airwaze.service</code></pre>
<p>Press <code>i</code> to start inserting text into the file and paste the following:</p>
<pre><code class="language-nohighlight">[Unit]
Description=Airwaze Studio
After=syslog.target

[Service]
User=airwaze
ExecStart=/usr/bin/java -jar /home/airwaze/app.jar SuccessExitStatus=143
Restart=always

[Install]
WantedBy=multi-user.target</code></pre>
<p>Once this service definition is in place, set the service to start automatically on boot with systemd using the <code>systemctl</code> utility and also start now:</p>
<pre><code class="language-nohighlight">$ sudo systemctl enable airwaze
$ sudo systemctl start airwaze</code></pre>
<p>And you can view the logs for the service with <code>journalctl</code>.</p>
<pre><code class="language-nohighlight">$ journalctl -f -u airwaze.service</code></pre>
<p>Now that your application is running, open up a new port in our Security Group from before to allow for web communications.</p>
<ul>
<li>Return to the AWS web console</li>
<li>Click <code>Security Groups</code> in the sidebar</li>
</ul>
<p><img src="../../materials/week05/security-groups-list.png" alt="Screen shot of the AWS sidebar with a red circle around Security Groups" /></p>
<ul>
<li>Select the security group with the name you used before</li>
</ul>
<p><img src="../../materials/week05/select-your-security-group.png" alt="Screen shot of the security group list with the demonstration security group selected" /></p>
<ul>
<li>Click the <code>Inbound</code> tab and <code>Edit</code> the inbound traffic list</li>
</ul>
<p><img src="../../materials/week05/security-group-inbound-tab.png" alt="Screen shot of the security group settings with a red circle around the selected Inbound tab" /></p>
<ul>
<li>Add a new <code>Custom TCP</code> rule for port 8080 and select <code>My IP</code> for the source</li>
</ul>
<p><img src="../../materials/week05/add-web-to-security-group.png" alt="Screen shot of Edit inbound rules display with a new rule of 8080 to "My IP" added with red circles around the 8080 port and "My IP"" /></p>
<ul>
<li>Click <code>Save</code>
This opens up a new port in the Security Group just for your IP. The Airwaze app is set up to listen to port 8080 and communicating with that port from your browser will allow you to communicate with the application.</li>
<li>Open your browser</li>
<li>Go to your server on port 8080:
<ul>
<li><a href="http://ec2-public-dns.us-east-2.compute.amazonaws.com:8080" target="_blank">http://ec2-public-dns.us-east-2.compute.amazonaws.com:8080</a></li>
</ul></li>
</ul>
<p>If you kept <code>journalctl</code> running from before, you should see the logs progress as your browser communicates with the app.</p>
<p>Congratulations! You now have your own application in the cloud!</p>
<h3 id="next-steps">Next Steps</h3>
<p>Your map is currently showing up on the screen; however, the map is not showing any airports.  Troubleshoot the application and figure out why the airports are not showing up.  Be sure to use your browser's developer tools. </p>
<p>When you have found the problem, build a new copy of your jar and deploy it on your server. </p>
<h3 id="bonus-mission">Bonus Mission</h3>
<ul>
<li>
<p>Use Environment Variables to dynamically change the port that your application is served on.</p>
</li>
<li>Using the instructions above, deploy another one of your SpringBoot application to AWS.  Consider using the <a href="https://gitlab.com/LaunchCodeTraining/launchcart/tree/rest-studio" target="_blank">LaunchCart Project</a>.  </li>
</ul>
                                    </section>

            </div>
        </main>

        <script type="text/javascript" src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
        <script type="text/javascript" src="https://education.launchcode.org/gis-devops/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="https://education.launchcode.org/gis-devops/js/highlight.pack.js"></script>
        <script type="text/javascript" src="https://education.launchcode.org/gis-devops/js/libgif.js"></script>

        <script>
            $(function() {
                $("section>h1").wrap('<div class="page-header" />');

                // Syntax highlighting
                hljs.configure({ displayLabels: true });
                hljs.initHighlightingOnLoad();
            });
        </script>

        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', "UA-78748330-11", 'auto');
            ga('send', 'pageview');

        </script>

    </body>
</html>
