<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>Working in Docker :: GIS DevOps</title>

        <link rel="stylesheet" href="https://education.launchcode.org/gis-devops/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://education.launchcode.org/gis-devops/css/highlight.launchcode.css">
        <link rel="stylesheet" href="https://education.launchcode.org/gis-devops/css/main.css">
        <link rel="stylesheet" href="https://djwbyvgln9kts.cloudfront.net/launch_ed_style/custom.css">
    </head>
    <body id='page-working-in-docker'>

        <header class="navbar navbar-default navbar-fixed-top">

            <ul class="nav navbar-nav">

                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle glyphicon glyphicon-menu-hamburger" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"></a>
                        <ul class="dropdown-menu">
                                                            <li class=" lc-button">
                                    <a href="https://education.launchcode.org/gis-devops/objectives/">
                                        Objectives
                                    </a>
                                </li>
                                                            <li class=" lc-button">
                                    <a href="https://education.launchcode.org/gis-devops/resources/">
                                        Resources
                                    </a>
                                </li>
                                                            <li class=" lc-button">
                                    <a href="https://education.launchcode.org/gis-devops/about/">
                                        About This Course
                                    </a>
                                </li>
                                                        <li role="separator" class="divider"></li>
                            <li>
                                <a href="#modalSearch" data-toggle="modal" data-target="#modalSearch">Search This Site</a>
                            </li>
                        </ul>
                    </li>

                
            </ul>

            <div>
                <a class="navbar-brand site-title navbar-center" href="https://education.launchcode.org/gis-devops/">
                    <h1>GIS DevOps</h1>
                </a>
            </div>

            <div class="nav navbar-nav navbar-right">
                <a class="navbar-brand dabomb" href="https://education.launchcode.org/gis-devops/"></a>
            </div>

        </header>

        <!-- Search Modal -->
        <div id="modalSearch" class="modal fade" role="dialog">
           <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                   <button type="button" class="close" data-dismiss="modal">&times;</button>
                   <h4 class="modal-title">Search GIS DevOps</h4>
                </div>
                <div class="modal-body">
                    <script>
                      (function() {
                        var cx = "014657181352409571810:oq1krtyri4k";
                        var gcse = document.createElement('script');
                        gcse.type = 'text/javascript';
                        gcse.async = true;
                        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
                        var s = document.getElementsByTagName('script')[0];
                        s.parentNode.insertBefore(gcse, s);
                      })();
                    </script>
                    <gcse:search></gcse:search>
                </div>
                <div class="modal-footer">
                   <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>

           </div>
        </div>

        <main class="container-fluid">
            <div class="row">

                <section id="content" class="col-sm-offset-2 col-sm-8">
                                        <h1>Working in Docker</h1>
                    <p>In this studio, you will be using Docker and Docker Compose to run the <strong>Airwaze</strong> web app.  By setting up Docker and Docker Compose you enable others to easily run your app.</p>
<h2 id="resources">Resources</h2>
<p>In this studio, you will be relying on the Docker and Docker Compose documentation.  Be sure to ask questions when you don't understand something, but try to use the docs as much as possible.  Here are some helpful resources:</p>
<ul>
<li><a href="https://devhints.io/docker-compose" target="_blank">Docker and Docker Compose Cheatsheet</a></li>
<li><a href="https://docs.docker.com/compose" target="_blank">Official Docker Compose Docs</a></li>
</ul>
<aside class="aside-warning">
<p>Remember that the <code>--link</code> flag is deprecated for Docker. Please use Docker Compose instead.  :-)</p>
</aside>
<h3 id="helpful-commands">Helpful Commands</h3>
<ul>
<li><code>sudo docker logs {container name}</code> show all of the logs written to <code>STDOUT</code>.</li>
<li><code>sudo docker exec -it {container name}</code> access to the command line inside the container.</li>
</ul>
<h2 id="goals">Goals</h2>
<p>At the end of this studio your project should have the following:</p>
<ol>
<li>A Docker file that runs the Airwaze executable jar file. </li>
<li>A Docker Compose file that allows you to stand up Airwaze with the command <code>docker-compose up</code> </li>
</ol>
<h2 id="setup">Setup</h2>
<p>To run Airwaze, you need two different containers:</p>
<ol>
<li>A Web server running with Java installed to run a Spring Boot executable jar file.</li>
<li>A PostGIS database.</li>
</ol>
<p>You will need to create a <code>Dockerfile</code> to run the Airwaze app.  Additionally, you will need a <code>docker-compose.yml</code> to connect the Airwaze container to the <code>postgis</code> container.  Use existing Docker images to run PostGIS.  Here are some Docker commands that we have used in the past to run PostGIS.</p>
<p>For running <strong>Postgis</strong>, we used the following docker command:</p>
<pre><code>docker run --name "postgis" -p 5432:5432 -d -t --env-file ./env.list kartoza/postgis:10.0-2.4</code></pre>
<h2 id="hints">Hints</h2>
<p>If you expose the port <code>5432</code> on your PostGIS container using the <code>-p 5432:5432</code> option, you will only be able to connect to it via<code>psql -h 127.0.0.1 -p 5432 -U airwaze_app_user airwaze</code></p>
<p>Settings up databases in Docker can be kind of tricky because they typically require setting up users and a schema before they can be used by an application server. Here is an example <code>docker-compose</code> file that configure the PostGIS container, note all of the file is not shown.</p>
<pre><code>  postgis:
    image: "kartoza/postgis:10.0-2.4"
    ports:
      - "5432:5432"
    environment:
      - POSTGRES_PASS=verysecurepassword
      - POSTGRES_USER=airwaze_app_user
      - POSTGRES_DBNAME=airwaze
    command: sh -c "echo \"host all all 0.0.0.0/0 md5\" &gt;&gt; /etc/postgresql/10/main/pg_hba.conf &amp;&amp; /start-postgis.sh"</code></pre>
<h2 id="bonus-missions">Bonus Missions</h2>
<p>Get your <strong>Zika CDC Dashboard</strong> to run via a <code>docker-compose.yml</code> file.</p>
<ul>
<li>Container running <strong>Zika CDC Dashboard</strong></li>
<li>Container running <strong>PostGIS</strong></li>
<li>Conatiner running <strong>ElasticSearch</strong></li>
<li>Conatiner runninng <strong>GeoServer</strong></li>
<li>DockerFile to create the <strong>Zika CDC Dashboard</strong> image</li>
<li>DockerFile to create and populate the <strong>PostGIS</strong> container </li>
<li>Docker compose file that spins up and connects the containers</li>
</ul>
<h2 id="zika-hints">Zika Hints</h2>
<p>For running <strong>Elasticsearch</strong>, we used the following docker command:</p>
<pre><code>docker run --name "es" -p 9200:9200 -p 9300:9300 -e "discovery.type=single-node"  -e "xpack.security.enabled=false" docker.elastic.co/elasticsearch/elasticsearch:5.6.0</code></pre>
                                    </section>

            </div>
        </main>

        <script type="text/javascript" src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
        <script type="text/javascript" src="https://education.launchcode.org/gis-devops/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="https://education.launchcode.org/gis-devops/js/highlight.pack.js"></script>
        <script type="text/javascript" src="https://education.launchcode.org/gis-devops/js/libgif.js"></script>

        <script>
            $(function() {
                $("section>h1").wrap('<div class="page-header" />');

                // Syntax highlighting
                hljs.configure({ displayLabels: true });
                hljs.initHighlightingOnLoad();
            });
        </script>

        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', "UA-78748330-11", 'auto');
            ga('send', 'pageview');

        </script>

    </body>
</html>
