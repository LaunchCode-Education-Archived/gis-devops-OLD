<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>Studio: Airwazes :: GIS DevOps</title>

        <link rel="stylesheet" href="https://education.launchcode.org/gis-devops/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://education.launchcode.org/gis-devops/css/highlight.launchcode.css">
        <link rel="stylesheet" href="https://education.launchcode.org/gis-devops/css/main.css">
        <link rel="stylesheet" href="https://djwbyvgln9kts.cloudfront.net/launch_ed_style/custom.css">
    </head>
    <body id='page-studio-airwazes'>

        <header class="navbar navbar-default navbar-fixed-top">

            <ul class="nav navbar-nav">

                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle glyphicon glyphicon-menu-hamburger" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"></a>
                        <ul class="dropdown-menu">
                                                            <li class=" lc-button">
                                    <a href="https://education.launchcode.org/gis-devops/objectives/">
                                        Objectives
                                    </a>
                                </li>
                                                            <li class=" lc-button">
                                    <a href="https://education.launchcode.org/gis-devops/resources/">
                                        Resources
                                    </a>
                                </li>
                                                            <li class=" lc-button">
                                    <a href="https://education.launchcode.org/gis-devops/about/">
                                        About This Course
                                    </a>
                                </li>
                                                        <li role="separator" class="divider"></li>
                            <li>
                                <a href="#modalSearch" data-toggle="modal" data-target="#modalSearch">Search This Site</a>
                            </li>
                        </ul>
                    </li>

                
            </ul>

            <div>
                <a class="navbar-brand site-title navbar-center" href="https://education.launchcode.org/gis-devops/">
                    <h1>GIS DevOps</h1>
                </a>
            </div>

            <div class="nav navbar-nav navbar-right">
                <a class="navbar-brand dabomb" href="https://education.launchcode.org/gis-devops/"></a>
            </div>

        </header>

        <!-- Search Modal -->
        <div id="modalSearch" class="modal fade" role="dialog">
           <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                   <button type="button" class="close" data-dismiss="modal">&times;</button>
                   <h4 class="modal-title">Search GIS DevOps</h4>
                </div>
                <div class="modal-body">
                    <script>
                      (function() {
                        var cx = "014657181352409571810:oq1krtyri4k";
                        var gcse = document.createElement('script');
                        gcse.type = 'text/javascript';
                        gcse.async = true;
                        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
                        var s = document.getElementsByTagName('script')[0];
                        s.parentNode.insertBefore(gcse, s);
                      })();
                    </script>
                    <gcse:search></gcse:search>
                </div>
                <div class="modal-footer">
                   <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>

           </div>
        </div>

        <main class="container-fluid">
            <div class="row">

                <section id="content" class="col-sm-offset-2 col-sm-8">
                                        <h1>Studio: Airwazes</h1>
                    <p>Your goal is to add an additional layer that shows flight routes and display it on the map.  This time we will incorporate our map into a Spring Boot project. Some starter code has been provided for you.</p>
<h2 id="set-up-project">Set Up Project</h2>
<ul>
<li>Fork and clone this <a href="https://gitlab.com/LaunchCodeTraining/airwaze-studio" target="_blank">Gitlab project</a>.</li>
<li>Then open the project in IntelliJ</li>
<li>Create a feature branch <code>$ git checkout -b day5-solution</code></li>
</ul>
<h2 id="set-up-postgis">Set Up PostGIS</h2>
<p>To install PostGIS, run the following commands in terminal:</p>
<pre><code class="language-nohighlight">$ brew update
$ brew install postgis</code></pre>
<p>This is going to take a while.</p>
<p>Make sure your Postgresql server is running. Remember we used <a href="https://postgresapp.com/" target="_blank"><a href="https://postgresapp.com/" target="_blank">https://postgresapp.com/</a></a> to install Postgresql, which automatically created a service that we can start and stop via its UI in the menu bar.</p>
<p>Run <code>psql</code> CLI by double clicking on the <code>postgres</code> database in the Postgresql app.</p>
<p>Open the Postgres UI and double click on the <code>postgres</code> db to open a <code>psql</code> command prompt.
Then execute:</p>
<pre><code class="language-nohighlight"># CREATE DATABASE airwaze;</code></pre>
<p>Also create a database for your tests:</p>
<pre><code class="language-nohighlight"># CREATE DATABASE airwaze_test;</code></pre>
<p>Now we want to install the geospatial extensions to Postgres for the <code>airwaze</code> db. Open the Postgres UI and double click on the <code>airwaze</code> db to open a <code>psql</code> command prompt connected to the <code>airwaze</code> db:</p>
<pre><code class="language-nohighlight"># CREATE EXTENSION postgis;
# CREATE EXTENSION postgis_topology;
# CREATE EXTENSION fuzzystrmatch;
# CREATE EXTENSION postgis_tiger_geocoder;</code></pre>
<p>Make sure that everything installed correctly by running this query:</p>
<pre><code class="language-nohighlight"># SELECT POSTGIS_FULL_VERSION();</code></pre>
<p>Remember to do that for your test database <code>airwaze_test</code> as well!</p>
<h2 id="create-users-and-grant-access-rights">Create Users and Grant Access Rights</h2>
<ul>
<li>Create users <code>airwaze_user</code> and <code>airwaze_test_user</code></li>
<li>Grant the users access to only what they need <code>airwaze_user</code> -&gt; <code>airwaze</code> and <code>airwaze_test_user</code> -&gt; <code>airewaze_test</code></li>
</ul>
<h2 id="now-lets-use-the-new-database">Now Let's Use the New Database</h2>
<p>Notice in <code>application.properties</code> and <code>application-test.properties</code> that the db configurtion refers to token values like <code>${APP_DB_NAME}</code> and <code>${APP_DB_HOST}</code>.</p>
<ul>
<li>Define each in environmment variables OR in Intellij run configurations</li>
<li>Do not commit db config information to source control</li>
</ul>
<h2 id="seed-data">Seed Data</h2>
<p>This application uses Spring Boot. If you have a <code>src/main/resources/import.sql</code> file, it will automatically run when the project boots up. Take a second to review <code>import.sql</code> in IntelliJ. The two <code>.csv</code> files were created from <code>.geojson</code> data.</p>
<ul>
<li>Review the <code>import.sql</code> file in the airwaze project</li>
<li>Open the <code>csv</code> files to see what data is being imported for routes and airports</li>
</ul>
<aside class="aside-note">
<p>Be sure that the <code>import.sql</code> points to local copies of the <code>airports.csv</code> and <code>routes.csv</code>. It needs to be the &quot;full path&quot; to each file on your local computer.</p>
</aside>
<h2 id="lets-see-it-in-action">Let's See It in Action</h2>
<ul>
<li>Run the <code>bootRun</code> gradle task.</li>
<li>Make sure there aren't any errors in the log.</li>
<li>Then go to <code>http://localhost:8080</code>. You should see a map with Mexico on it that includes a map layer for airports as red circles.</li>
</ul>
<h2 id="review-the-created-tables-and-imported-data-in-postgis">Review the Created Tables and Imported Data in Postgis</h2>
<p>Open a <code>psql</code> prompt connected to <code>airwaze</code> database and then run these commands one at a time</p>
<pre><code class="language-sql">airwaze=# select count(*) from route;
airwaze=# select count(*) from airport;
airwaze=# \d
airwaze=# \d airport
airwaze=# \d route</code></pre>
<h2 id="review-airportcontroller">Review AirportController</h2>
<ul>
<li>Visit this url in your browser: <a href="http://localhost:8080/airport/" target="_blank">http://localhost:8080/airport/</a>.  Note the trailing <code>/</code> is important.</li>
<li>Then look at the code that returns that data.</li>
</ul>
<h2 id="tasks">Tasks</h2>
<ol>
<li>When the map is clicked, list all airports that are at that pixel
<ul>
<li>You will need to add more code to the function <code>map.forEachFeatureAtPixel(event.pixel, function(feature,layer)</code> in <code>resources/static/js/scripts.js</code></li>
</ul></li>
<li>Create a route endpoint that returns routes for a certain srcId. Example: <code>http://localhost:8080/route/?srcId=12</code></li>
<li>When an airport feature is clicked on the map, show the routes for that airport
<ul>
<li>By adding a router layer that only contains routes connected to the clicked airport</li>
<li>The data for the new layer will be provided by <code>http://localhost:8080/route/?srcId=X</code>, where X will be the <code>airportId</code> from the feature. </li>
</ul></li>
<li>Write tests for all of this. Tests are your friend :) </li>
</ol>
<h2 id="bonus-missions">Bonus Missions</h2>
<ul>
<li>Get this to work without jQuery. Hints: <a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch" target="_blank">fetch</a> and <code>document.findElementById</code></li>
<li>Change the style of the dots: color, size, fill in</li>
<li>Sort airports by alpha order when they are displayed below the map</li>
<li>Check what kind of feature was clicked when map.onclick runs</li>
<li>Remove previous route layers when adding a new one</li>
<li>Add a list of routes in HTML form below the map</li>
</ul>
<h2 id="problems">Problems</h2>
<p>Invalid JSON will cause the jQuery callback to not fire.  If you are having an issue, validate the JSON that you are sending across the wire.  Here is a <a href="https://jsonlint.com/" target="_blank">JSON Validator</a>.</p>
<p>Invalid GeoJSON will not show up on your map.  You will see the data pull back, but you will not see any data displayed.  Validate your GeoJSON.  Here is a <a href="http://geojson.io/o" target="_blank">GeoJSON Validator</a>.</p>
<p>If you get the message <code>The element type "link" must be terminated by the matching end-tag "&lt;/link&gt;".</code>, then add the following tag <code>&lt;html lang="en" xmlns:th="http://www.thymeleaf.org/"&gt;</code>.</p>
<h2 id="resources">Resources</h2>
<ul>
<li><a href="https://macwright.org/2015/03/23/geojson-second-bite" target="_blank">Read about constructing GeoJSON</a></li>
<li><a href="https://openlayers.org/en/latest/examples/" target="_blank">OpenLayers Examples</a></li>
<li><a href="http://www.acuriousanimal.com/thebookofopenlayers3/chapter02_01_adding_removing_layers.html" target="_blank">Adding and Removing Layers</a></li>
<li><a href="http://geojson.io" target="_blank">Validate your GeoJSON!</a></li>
<li><a href="http://openlayers.org/en/latest/examples/geojson.html" target="_blank">OpenLayers Drawing Examples</a></li>
</ul>
                                    </section>

            </div>
        </main>

        <script type="text/javascript" src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
        <script type="text/javascript" src="https://education.launchcode.org/gis-devops/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="https://education.launchcode.org/gis-devops/js/highlight.pack.js"></script>
        <script type="text/javascript" src="https://education.launchcode.org/gis-devops/js/libgif.js"></script>

        <script>
            $(function() {
                $("section>h1").wrap('<div class="page-header" />');

                // Syntax highlighting
                hljs.configure({ displayLabels: true });
                hljs.initHighlightingOnLoad();
            });
        </script>

        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', "UA-78748330-11", 'auto');
            ga('send', 'pageview');

        </script>

    </body>
</html>
